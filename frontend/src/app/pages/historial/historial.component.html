<div class="history-wrapper">

  <h2 (click)="showHistory = !showHistory" class="history-toggle">
    Campaign History
    <span class="arrow">
      {{ showHistory ? '▲' : '▼' }}
    </span>
  </h2>

  <div *ngIf="showHistory" class="history-content">

    <div class="filters">
      <input
        type="text"
        placeholder="Search by subject..."
        [(ngModel)]="subjectFilter"
      />

      <input
        type="date"
        [(ngModel)]="minDateFilter"
      />

      <input
        type="date"
        [(ngModel)]="maxDateFilter"
      />
    </div>

    <table
      class="history-table"
      *ngIf="filteredHistory().length > 0; else noResults"
    >
      <thead>
        <tr>
          <th>Subject</th>
          <th>Template</th>
          <th>Sent at</th>
          <th>Recipients</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let campaign of filteredHistory()">

          <td>{{ campaign.subject }}</td>

          <td>
            {{ campaign.template_name || 'Deleted' }}
          </td>

          <td>
            {{ campaign.sent_at | date:'short' }}
          </td>

          <td>
            {{ campaign.total_recipients }}
          </td>

        </tr>
      </tbody>
    </table>

    <ng-template #noResults>
      <p>No results found.</p>
    </ng-template>

    <div
      class="show-more-wrapper"
      *ngIf="history.length > 5"
    >
      <button
        (click)="showAll = !showAll"
        class="show-more-btn"
      >
        {{ showAll ? 'Show less ▲' : 'Show more ▼' }}
      </button>
    </div>

  </div>
</div>
